# MSC4414: Design decision - Errors

A proposal to set the direction for error design in the future.


## Process note

A typical MSC will change the actual specification itself. This MSC is a little different because it
doesn't have such a direct impact on the spec. Instead, this proposal acts as an open discussion
place and sets a given design direction for a part of Matrix. Future/existing MSCs can use the outcome
of this proposal to help shape their own technical design, allowing them to be more successful in the
process.

This proposal is also meant to be lacking any meaningful technical details. The goal is to reach a
consensus for broad direction rather than specific data structures or implementation. MSCs which build
upon this proposal's outcome will explore possible implementations.

This proposal's expected trajectory through the MSC process looks something like this:

1. The MSC is opened with no specific direction chosen.
2. The SCT and community review the MSC, shaping its direction. The intention is to avoid a simple
   vote. Instead, review should aim to add details and nuance to the proposal text.                    **<-- YOU ARE HERE**
3. The MSC is updated to head in the direction which looks to have rough consensus.
4. Further review happens as needed.
5. The MSC is put forward for FCP (merge) by the SCT. This indicates preference to choose the direction
   outlined by the MSC.
6. A (hopefully) successful FCP happens. The proposal is incorporated into the spec as a preferred
   approach. For example, in the [Guiding Principles section](https://spec.matrix.org/v1.17/proposals/#guiding-principles)
   of the spec process itself. New sections may be created as needed.
7. MSCs propose changes using this MSC's defined outcome.

Comments not in threads will be ignored by the author, per normal process. Please prefer to leave comments
on the most applicable paragraph, or a heading within the proposal if supplying broader feedback.


## Background / Introduction

Over 2025 and into 2026, a few features have wanted to give more descriptive error messages to users.
Many clients in Matrix "reinterpret" errors from the server to provide something a bit more local to
the user, though in some cases can hide the detail the server is trying to convey. For example, in
a Trust & Safety (T&S) environment, the server may be trying to indicate that a message was denied
due to spam, but the client simply shows "failed to send message". In another example, a server may
be trying to provide more specific wording or detail about why the user might need to choose a paid
plan on the server, but the client is hiding that with a generic "a limit was reached" error.

For some clients, reinterpretation of errors is required specifically because servers have historically
provided not-so-great error messages, like "Invalid signature for server t2l.io with key ed25519:a_iRjt:
Unable to verify signature for t2l.io". Some instances of these have been fixed by servers over the
years, but users can still run into impossible-to-understand errors in some clients.

Ideally, clients also show errors in the user's chosen language. It can be jarring to a user when they're
reading an error in English but the rest of the app is not-English. Servers almost exclusively produce
error messages in English, though they do have access to things like the [`Accept-Language` header](https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Accept-Language).
If the server generates the translation, the server might be lacking language support compared to the
client and therefore show something in a different language to the user.

Instead of the server translating errors, clients could be provided with significantly more detail
on errors. Currently, clients have access to a Matrix error code, HTTP status code, and plain text
error message generated by the server. Adding more detail, such as additional fields or finer-grained
Matrix error codes, would enable clients to construct a more informative error message. As the detail
offered by the server (and spec) increases over time, clients would need to update their error presentation
too. This could potentially mean users see the "wrong" message while their server and client updates
are desynchronized (not all users are in control of their Matrix stack: a delayed app store update
might prevent their client from supporting new detail offered by a freshly upgraded server).

It is worth noting that the [current specification](https://spec.matrix.org/v1.17/client-server-api/#standard-error-response)
does intend that server-returned error messages are "human readable". As implied above however, human
understanding can and does differ from readability. "Invalid signature" is better understood by a
server (or possibly client) developer, but is meaningless to an end user. "Failed to join room due to
a server error" would be a better representation of the problem for an end user.

Overall, this proposal intends to solve [matrix-spec#377](https://github.com/matrix-org/matrix-spec/issues/377)
by clarifying whether clients should rely on their own generation for errors or the server's generation
of errors. If (continuing to) rely on their own code, servers will need to supply more detail to clients
so they can do so. If (returning to) reliance on the server's own message, servers may have to support
translations. Servers may also be interested in being able to offer not just plaintext error messages
to create a richer experience in the client.


## Proposal

*As per the process note above, this section is not yet completed. It will be populated once rough
consensus is achieved.*


## Potential issues

*As per the process note above, this section is not yet completed. It will be populated once rough
consensus is achieved.*


## Alternatives

*As per the process note above, this section is not yet completed. It will be populated once rough
consensus is achieved.*


## Security considerations

*As per the process note above, this section is not yet completed. It will be populated once rough
consensus is achieved.*


## Unstable prefix

This proposal is direction-setting and has no technical component. It therefore does not have an
unstable prefix. MSCs which depend on this MSC should have their own unstable prefixes.


## Dependencies

This proposal has no direct dependencies. Multiple MSCs may be waiting for a conclusion to this MSC
before attempting to make forward progress, however.
